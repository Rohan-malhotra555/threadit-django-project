<!-- This is a "doctype" declaration. It's a standard line that tells the
     web browser "This is a modern HTML5 document." -->
<!DOCTYPE html>

<!-- This is the root tag. All of your HTML code goes inside this.
     lang="en" just tells the browser the page is in English. -->
<html lang="en">

<!-- The <head> tag holds "meta-information" about your page. This is
     stuff the user doesn't see (like the title in the browser tab). -->
<head>
    <!-- This tells the browser to use the UTF-8 character set, which
         is a standard that includes all emojis and special characters. -->
    <meta charset="UTF-8">

    <!-- This is a critical line for mobile phones. It tells the phone
         to set the width of the page to the device's screen width.
         This is what makes a website "responsive." -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- This is the text that appears in the browser tab. -->
    <title>Welcome to Threadit</title>

    <!-- This is an "Internal Style Sheet." We are writing CSS code
         directly inside our HTML file. Later, we will move this to
         its own .css file, but this is perfect for now. -->
    <style>
        /* This sets the style for the entire <body> (the whole page) */
        body { 
            font-family: sans-serif;  /* Use a clean, standard font */
            max-width: 800px;         /* Don't let the content get too wide on big screens */
            margin: 20px auto;        /* '20px' top/bottom, 'auto' left/right (this centers the 800px block) */
            padding: 15px;            /* Add some space inside the main content area */
            background-color: #f4f4f4; /* A light grey background color */
        }
        
        /* This is the main container for a single post */
        .post { 
            display: flex; /* This is the key: makes children (.vote-container, .post-content) sit side-by-side */
            align-items: flex-start; /* Aligns items to the top */
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        /* This styles the left-hand voting column */
        .vote-container {
            display: flex; /* Makes the items inside this (arrows, score) flexible */
            flex-direction: column; /* Stacks the items vertically */
            align-items: center;  /* Centers them horizontally */
            padding-right: 15px; /* Adds space between voting and content */
            flex-shrink: 0; /* Stops this column from shrinking */
        }
        
        /* This styles the up/down arrow links */
        .vote-link {
            font-size: 20px; /* Makes arrows bigger */
            text-decoration: none; /* Removes the underline */
            color: #888; /* Grey color */
        }
        .vote-link:hover {
            color: #555; /* Blue on hover */
        }

        .vote-link.voted-up {
            color: #007bff;
        }

        .vote-link.voted-down {
            color: #ff4500;
        }
        
        /* This styles the vote count number */
        .score {
            font-size: 18px;
            font-weight: bold;
            color: #555;
            margin: 5px 0; /* Adds vertical space around the score */
        }
        
        /* This styles the right-hand content column */
        .post-content {
            flex-grow: 1; /* Allows the content to take up all remaining horizontal space */
        }

        /* Styles for the text inside the post-content */
        .post-content h2 { 
            margin: 0 0 10px 0;
        }
        .post-meta { 
            font-size: 0.9em;
            color: #777;
        }
    </style>
</head>

<!-- The <body> tag holds all the actual content the user will see
     (text, images, links, etc.) -->
<body>

    <!-- A main heading for the page -->
    <h1>Welcome to Threadit</h1>

    <div>

        {% if user.is_authenticated %}

            <p> Hello, {{ user.username }}! | 
            <a href="{% url 'create_post' %}">Create Post</a>
            | <a href="{% url 'create_community' %}">Create Community</a>
            | <a href="{% url 'logout' %}">Logout</a></p> 

        {% else %}
        
            <p> <a href="{% url 'login' %}">Login</a> | <a href="{% url 'signup'%}">Sign Up</a></p>

        {% endif %}

    </div>
    
    <!-- <hr> just means "horizontal rule," a simple dividing line. -->
    <hr>

    <h2>All Posts</h2>

    <!--
      DJANGO TEMPLATE LANGUAGE (DTL) STARTS HERE
      This is not HTML. This is a command for Django.
      {perc ... perc} is a "Tag." It does something (like a loop or an if-statement).
      
      This line says: "Find the 'posts' variable from the context dictionary
      we passed from the view. Then, loop through every item in that list.
      For each item, temporarily call it 'post'."
    -->
    {% for post in posts %}

        <!-- This is a standard HTML div. We give it a class of "post"
             so it gets the styles we defined in the <style> tag above. -->
        <div class="post">

            <!--
              {{ ... }} is a "Variable Tag." It means "print something."
              This line tells Django: "Get the current 'post' from the loop
              and print its 'title' field."
            -->

            <div class="vote-container">

                <a href="{% url 'upvote_post' post.id %}" 
                class="vote-link {% if user.is_authenticated and user in post.upvotes.all %}voted-up{% endif %}">&#x25B2;</a>
                <p class="score">{{ post.score }}</p>
                <a href="{% url 'downvote_post' post.id %}" 
                class="vote-link {% if user.is_authenticated and user in post.downvotes.all %}voted-down{% endif %}">&#x25BC;</a>

            </div>

            <div class="post-content">
                <h2>
                    <a href="{% url 'post_detail' post.id %}">{{ post.title }}</a>
                </h2>

                <p class="post-meta">
                    Posted in <a href=" {% url 'community_detail' post.community.name %}">
                        <!--
                        Here, we print the 'post.community'.
                        Because of your `def __str__` method in models.py,
                        Django is smart enough to print the *name* of the
                        community (e.g., "python") instead of a
                        confusing ID (e.g., "1").
                        -->
                        {{ post.community }}
                    </a> 
                    on 
                    <!--
                    Here we print the 'created_at' timestamp.
                    The | is a "Filter." It formats the data.
                    |date:"F d, Y" tells Django to format the date
                    like "October 26, 2025".
                    
                    :"F d, Y": This is an argument passed to the date filter. It's a format string telling the filter how you want the date to look, using standard codes:

                        F: Full month name (e.g., "October")

                        d: Day of the month, with leading zero (e.g., "05", "26")

                        Y: Four-digit year (e.g., "2025")
                    -->
                    {{ post.created_at|date:"F d, Y" }} 
                    by <a href="{% url 'profile' post.author.username %}">{{ post.author.username }}</a>
                </p>

                <!-- This just prints the 'content' field of the post -->
                {% if post.content %}

                    <p>{{ post.content }}</p>
                {% endif %}

            </div>

        </div>

    <!--
      This tag tells Django: "The loop ends here."
      It will repeat everything between here and the {for} tag
      for every single post in your list.
    -->
    {% endfor %}

</body>
</html>