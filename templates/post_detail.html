{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center mt-4">
    <div class="col-md-8">

        <div class="card shadow mb-4">
            <div class="card-header bg-white">
                <small class="text-muted">
                    Posted by <strong>{{ post.author.username }}</strong>
                    in <a href="{% url 'community_detail' post.community.slug %}" class="text-decoration-none"><span
                            class="badge bg-primary">{{ post.community.name }}</span></a>
                </small>
            </div>
            <div class="card-body">
                <h2 class="card-title text-primary">{{ post.title }}</h2>
                <p class="card-text fs-5">{{ post.content }}</p>
                {% if post.image %}
                <div class="text-center">
                    <img src="{{ post.image.url }}" class="img-fluid rounded mt-3">
                </div>
                {% endif %}
            </div>
            <div class="card-footer bg-white">
                <div class="d-flex align-items-center">
                    <form action="{% url 'upvote_post' post.id %}?next={{ request.path }}" method="POST">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-link text-decoration-none p-0">
                            {% if request.user in post.upvotes.all %}
                            <i class="bi bi-arrow-up-circle-fill fs-4 text-warning"></i>
                            {% else %}
                            <i class="bi bi-arrow-up-circle fs-4 text-secondary"></i>
                            {% endif %}
                        </button>
                    </form>

                    <span class="mx-2 fw-bold text-dark">{{ post.score }}</span>

                    <form action="{% url 'downvote_post' post.id %}?next={{ request.path }}" method="POST">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-link text-decoration-none p-0">
                            {% if request.user in post.downvotes.all %}
                            <i class="bi bi-arrow-down-circle-fill fs-4 text-primary"></i>
                            {% else %}
                            <i class="bi bi-arrow-down-circle fs-4 text-secondary"></i>
                            {% endif %}
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <h5>Leave a comment</h5>
                <form method="post">
                    {% csrf_token %}
                    {{ comment_form.content }}
                    <button type="submit" class="btn btn-primary mt-2 btn-sm">Post Comment</button>
                </form>
            </div>
        </div>

        <h5 class="mb-3">Comments ({{ post.comments.count }})</h5>

        {% for comment in post.comments.all %}
        <div class="card mb-2 border-0 shadow-sm">
            <div class="card-body p-3">
                <div class="d-flex justify-content-between">
                    <h6 class="fw-bold mb-1">{{ comment.author.username }}</h6>
                    <small class="text-muted">{{ comment.created_at|timesince }} ago</small>
                </div>
                <p class="mb-0 text-secondary">{{ comment.content }}</p>
            </div>
        </div>
        {% empty %}
        <p class="text-muted">No comments yet. Be the first!</p>
        {% endfor %}

    </div>
</div>
{% endblock %}
















<!-- {% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ post.title }}</title>

    <link rel="stylesheet" href="{% static 'css/style.css' %}">


</head>


<body>

    <p><a href="{% url 'home' %}">&laquo; Back to all Posts</a></p>
    
    <div class="post">

        <div class="vote-container">

            <a href="{% url 'upvote_post' post.id %}?next={{ request.path }}"
            class="vote-link {% if user.is_authenticated and user in post.upvotes.all %}voted-up{% endif %}">&#x25B2;</a>

            <p class="score">{{ post.score }}</p>

            <a href="{% url 'downvote_post' post.id %}?next={{ request.path }}"
            class="vote-link {% if user.is_authenticated and user in post.downvotes.all %}voted-down{% endif %}">&#x25BC;</a>

        </div>

        <div class="post-content">

            <h1>{{ post.title }}</h1>

            <p class="post-meta">
                Posted by <a href="{% url 'profile' post.author.username %}">{{ post.author.username }}</a>
                in <a href="{% url 'community_detail' post.community.name %}">{{ post.community.name }}</a>
                on {{ post.created_at|date:"F d, Y" }}
            </p>

            {% if post.image %}

                <div class="post-image-container">
                    <img src="{{ post.image.url }}" alt="{{ post.title }}">
                </div>
                
            {% endif %}

            <p>{{ post.content }}</p>

            {% if user == post.author %}

                <div class="post-actions">
                    <a href="{% url 'edit_post' post.id %}">Edit</a>

                    <form action="{% url 'delete_post' post.id %}" method="POST" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" style="background:none; border:none; padding:0; color:blue; text-decoration:underline; cursor:pointer;">
                            Delete
                        </button>
                    </form>
                </div>

            {% endif %}
                
        </div>
    </div>


    {% if user.is_authenticated %}

        <div class="comment-form">

            <h3>Add a comment</h3>

            <form method="POST">

                {% csrf_token %}

                {{ comment_form.as_p }}

                <button type="submit">Submit Comment</button>
            </form>
        </div>
    {% else %}
        <p>You must be <a href="{% url 'login'%}?next={{ request.path }}">Logged in</a> to comment.</p>
    {% endif %}
    

    <div class="comment-list">

        <h2>Comments</h2>

        {% for comment in comments %}

            <div class="comment">

                <p class="comment-meta">
                    <a href="{% url 'profile' comment.author.username %}">{{ comment.author.username }}</a>
                    - {{ comment.created_at|date:"f A, F d, Y"}}
                </p>

                <p>{{ comment.content }}</p>

                {% if user == comment.author %}
                    
                    <div class="comment-actions">
                        <a href="{% url 'edit_comment' comment.id %}">Edit</a>

                        <a href="{% url 'delete_comment' comment.id %}">Delete</a>
                    </div>

                {% endif %}
                        
            </div>

        {% empty %}
            <p>No comments yet. Be the first!</p>
        {% endfor %}
    </div>

</body>
</html> -->


<!--

Detailed Explanation of the <body> Section (the old template without bootstrap)

The body is broken down into three main sections:

Displaying the main post.

Displaying the "Add Comment" form (or a login link).

Displaying the list of existing comments.


Section 1: Displaying the Main Post
This part uses the post object that you passed from your view's context.

<p><a href="{perc url 'home' perc}">&laquo; Back to All Posts</a></p> This is a navigation link to go back to the homepage.

{perc url 'home' perc}: This is a template tag that generates the URL for the path named 'home' (which is /). This is safer than hard-coding the URL.

&laquo;: This is just an HTML code for the Â« symbol.

<div class="post"> ... </div> This is the main container for the post, styled by your CSS to look like a white box.

<h1>{{ post.title }}</h1> This is a variable tag. It takes the post object and prints the value of its title attribute.

<p class="post-meta"> ... </p> This paragraph holds the post's "metadata."

{{ post.author.username }}: This is a ForeignKey lookup. It takes the post object, follows its author link to the User object, and then prints the username of that User.

<a href="{perc url 'community_detail' post.community.name perc}">: This is a dynamic URL tag.

{perc url 'community_detail' ... perc}: It looks up the URL pattern named 'community_detail'.

post.community.name: It takes the name of the post's community (e.g., "Python") and passes it as the argument that the URL pattern (<str:community_name>) is expecting. This builds the correct link (e.g., /community/Python/).

{{ post.community.name }}: This prints the community's name as the clickable text for the link.

{{ post.created_at|date:"F d, Y" }}: This prints the post's timestamp. The | (pipe) sends the variable to the date filter, which formats it as "October 26, 2025".

<p>{{ post.content }}</p> This prints the main text content of the post.



Section 2: The "Add Comment" Form
This section is conditional. It checks if the user is logged in.

{perc if user.is_authenticated perc} This is a block tag. It checks the user object (which is automatically available in all templates) and sees if its is_authenticated attribute is True.

<form method="POST"> ... </form> This block is only shown if the if is True.

method="POST": Tells the browser to send data when this form is submitted. This triggers the POST logic in your post_detail view.

{perc csrf_token perc}: The mandatory security token to prevent CSRF attacks.

{{ comment_form.as_p }}: Renders the CommentForm (passed from your view's context). .as_p automatically displays the content textarea, wrapped in <p> tags.

<button type="submit">: The button that triggers the form's POST submission.

{perc else perc} This block is shown if the if is False (the user is logged out).

<p><a href="{perc url 'login' perc}?next={{ request.path }}">logged in</a>...</p> This is a "smart link" to the login page.

{perc url 'login' perc} generates the /login/ URL.

?next={{ request.path }} adds a query parameter to the URL. request.path is a variable that holds the current page's URL (e.g., /post/1/).

The full link becomes /login/?next=/post/1/. Django's LoginView will see this next parameter and automatically redirect the user back to this post after they successfully log in.

{perc endif perc} This closes the if/else block.



Section 3: The List of Existing Comments
This section uses the comments list from your view's context.

<h2>Comments</h2> A simple heading for the section.

{perc for comment in comments perc} This is a loop. It takes the comments list (which you filtered and ordered in your view) and iterates through it, one item at a time. Each item is temporarily stored in the comment variable.

<div class="comment"> ... </div> A styled container for each individual comment.

{{ comment.author.username }}: Prints the username of the comment's author.

{{ comment.created_at|date:"f A, F d, Y" }}: Prints the comment's timestamp with a different format (e.g., "4:30 p.m., October 26, 2025").

<p>{{ comment.content }}</p>: Prints the actual text of the comment.

{perc empty perc This is a special tag inside the for loop. The HTML after this tag (up to {perc endfor perc}) will only be displayed if the comments list was empty.

{perc endfor perc} This closes the for loop.


-->